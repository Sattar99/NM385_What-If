<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.71/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.71/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        @import url(Cesium/Widgets/widgets.css);
        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 98%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        #footerTable {
            width: 100%;
        }
        
        footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30px;
            background: #ccc;
        }
        
        #gyroButton {
            width: 100%;
            position: absolute;
        }
    </style>
    <script type="text/javascript" src="cordova.js"></script>
    <title>DORA</title>
</head>

<body>
    <!--width: device-width; initial-scale=1; maximum-scale=1; minimum-scale=1; user-scalable=no-->
    <div id="cesiumContainer"></div>
    <script>
        var enableGyro = false;
        window.addEventListener("deviceorientation", handleOrientation, true);

        function handleOrientation(event) {
            var alpha = event.alpha;
            var beta = event.beta;
            var gamma = event.gamma;
            document.getElementById('gyroText').innerHTML = enableGyro ? alpha + '&nbsp;&nbsp;' + beta + '&nbsp;&nbsp;' + gamma : '';

        }
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxM2IwN2IyYy1kNTJhLTQzNWYtYjc1Zi04YTcwOTRlYmIyNzUiLCJpZCI6MjE3MjUsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1ODA0MDk4MzJ9.YMusm2MIxy01Tk7obCee6kmeWX0_7nMHK51HJBOO7Jo';
        var viewer = new Cesium.Viewer("cesiumContainer", {
            vrButton: true,
            terrainExaggeration: 2.0,
        });
        viewer.terrainProvider = new Cesium.CesiumTerrainProvider({
            url: 'https://api.maptiler.com/tiles/terrain-quantized-mesh/?key=K2NSsLQ0XHXPJnpQGj7Z' // get your own key at https://cloud.maptiler.com/
        });
        var scene = viewer.scene;
        var canvas = viewer.canvas;
        canvas.setAttribute("tabindex", "0"); // needed to put focus on the canvas
        canvas.onclick = function() {
            canvas.focus();
        };


        var ellipsoid = scene.globe.ellipsoid;

        var voice = {
            permission: true,
            initialize: function() {
                document.addEventListener('deviceready', this.onDeviceReady.bind(this), false);
            },
            onDeviceReady: function() {
                var self = this;
                window.plugins.speechRecognition.hasPermission(
                    function(permission) {
                        if (!permission) {
                            window.plugins.speechRecognition.requestPermission(
                                function(permissionTrue) {
                                    self.permission = true;
                                    if (permissionTrue == 'OK') {
                                        alert("Voice command access permission successfully accepted!");
                                    } else {
                                        alert("Permission to access voice command denied!");
                                    }
                                },
                                function(erro) {
                                    self.permission = false;
                                    alert("permission error" + erro);
                                });
                        }
                    },
                    function(error) {
                        alert("erro");
                        alert(error);
                    });
            },
            stopCommand: function() {
                window.plugins.speechRecognition.stopListening(
                    function() {
                        alert("Voice command disabled!");
                        var text = "";
                        $("#texto").html("").append(text);
                    },
                    function() {
                        alert("erro");
                    });
            },
            voiceCommand: function() {
                var self = this;
                if (!self.permission) {
                    alert("No permission to use the microphone");
                    return false;
                }
                var options = {
                    language: "pt-BR",
                    showPartial: true,
                    showPopup: false
                };
                window.plugins.speechRecognition.startListening(
                    function(dados) {
                        $.each(dados, function(key, texto) {
                            $("#texto").html("").append(texto);
                            if (texto == "e") {
                                mounteverest();
                            } else if (texto == "Dom") {
                                halfdome();
                            } else if (texto == "Santos") {
                                var target = new Cesium.Cartesian3(-2708814.85583248, -4254159.450845907,
                                    3891403.9457429945
                                );
                                var offset = new Cesium.Cartesian3(
                                    70642.66030209465, -31661.517948317807,
                                    35505.179997143336
                                );
                                viewer.camera.lookAt(target, offset);
                                viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
                            }
                        });
                    },
                    function(erro) {
                        alert("error: " + erro);
                    },
                    options);
            },
        };
        var watch = 0;
        var xPos = 0;
        var yPos = 0;
        window.onload = function() {
            //init();
            document.addEventListener("deviceready", init, false);
        }

        function init() {
            watch = navigator.accelerometer.watchAcceleration(success, failure, {
                frequency: 100
            });
        }

        function success(accel) {
            document.getElementById("xOut").innerHTML = accel.x;
            document.getElementById("yOut").innerHTML = accel.y;
            document.getElementById("zOut").innerHTML = accel.z;
            xPos += -1 * (accel.x * 1.5);
            yPos += (accel.y * 1.5);
        }

        function failure() {
            notification.alert("Error");
        }

        function mounteverest() {
            var target = new Cesium.Cartesian3(
                300770.50872389384,
                5634912.131394585,
                2978152.2865545116
            );
            var offset = new Cesium.Cartesian3(
                6344.974098678562, -793.3419798081741,
                2499.9508860763162
            );
            viewer.camera.lookAt(target, offset);
            viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);

        }

        function halfdome() {
            var target = new Cesium.Cartesian3(-2489625.0836225147, -4393941.44443024,
                3882535.9454173897
            );
            var offset = new Cesium.Cartesian3(-6857.40902037546,
                412.3284835694358,
                2147.5545426812023
            );
            viewer.camera.lookAt(target, offset);
            viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);

        }
        var startMousePosition;
        var mousePosition;
        var flags = {
            looking: false,
            moveForward: false,
            moveBackward: false,
            moveUp: false,
            moveDown: false,
            moveLeft: false,
            moveRight: false,
        };
        var handler = new Cesium.ScreenSpaceEventHandler(canvas);
        handler.setInputAction(function(movement) {
            flags.looking = true;
            mousePosition = startMousePosition = Cesium.Cartesian3.clone(
                movement.position
            );
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);
        handler.setInputAction(function(movement) {
            mousePosition = movement.endPosition;
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
        handler.setInputAction(function(position) {
            flags.looking = false;
        }, Cesium.ScreenSpaceEventType.LEFT_UP);

        function getFlagForKeyCode(keyCode) {
            switch (keyCode) {
                case "W".charCodeAt(0):
                    return "moveForward";
                case "S".charCodeAt(0):
                    return "moveBackward";
                case "Q".charCodeAt(0):
                    return "moveUp";
                case "E".charCodeAt(0):
                    return "moveDown";
                case "D".charCodeAt(0):
                    return "moveRight";
                case "A".charCodeAt(0):
                    return "moveLeft";
                case "X".charCodeAt(0):
                    return "Search";
                default:
                    return undefined;
            }
        }
        viewer.entities.add({
    position: Cesium.Cartesian3.fromDegrees(86.922623, 27.986065, null, ellipsoid),
    point : {
        color : Cesium.Color.SKYBLUE,
        pixelSize : 10,
        outlineColor : Cesium.Color.YELLOW,
        outlineWidth : 3,
        heightReference : Cesium.HeightReference.CLAMP_TO_GROUND
    },
  label : {
        text : '"mount everest" height:8,848 m ',
        
        font : '8pt sans-serif',
        heightReference : Cesium.HeightReference.CLAMP_TO_GROUND,
        horizontalOrigin : Cesium.HorizontalOrigin.LEFT,
        verticalOrigin : Cesium.VerticalOrigin.BASELINE,
        fillColor : Cesium.Color.BLACK,
        showBackground : true,
        backgroundColor : new Cesium.Color(1, 1, 1, 0.7),
        backgroundPadding : new Cesium.Cartesian2(8, 4),
        disableDepthTestDistance : Number.POSITIVE_INFINITY // draws the label in front of terrain
    }
  });
viewer.entities.add({
    position: Cesium.Cartesian3.fromDegrees( 119.7273,37.7137,null, ellipsoid),
    point : {
        color : Cesium.Color.SKYBLUE,
        pixelSize : 10,
        outlineColor : Cesium.Color.YELLOW,
        outlineWidth : 3,
        heightReference : Cesium.HeightReference.CLAMP_TO_GROUND
    },
  label : {
        text : 'HalfDome height: 2694m',
        
        font : '8pt sans-serif',
        heightReference : Cesium.HeightReference.CLAMP_TO_GROUND,
        horizontalOrigin : Cesium.HorizontalOrigin.LEFT,
        verticalOrigin : Cesium.VerticalOrigin.BASELINE,
        fillColor : Cesium.Color.BLACK,
        showBackground : true,
        backgroundColor : new Cesium.Color(1, 1, 1, 0.7),
        backgroundPadding : new Cesium.Cartesian2(8, 4),
        disableDepthTestDistance : Number.POSITIVE_INFINITY // draws the label in front of terrain
    }
  });
viewer.entities.add({
    position: Cesium.Cartesian3.fromDegrees( 37.6910, 122.3108,null, ellipsoid),
    point : {
        color : Cesium.Color.SKYBLUE,
        pixelSize : 10,
        outlineColor : Cesium.Color.YELLOW,
        outlineWidth : 3,
        heightReference : Cesium.HeightReference.CLAMP_TO_GROUND
    },
  label : {
        text : 'SanFranciscoBay ',
        
        font : '8pt sans-serif',
        heightReference : Cesium.HeightReference.CLAMP_TO_GROUND,
        horizontalOrigin : Cesium.HorizontalOrigin.LEFT,
        verticalOrigin : Cesium.VerticalOrigin.BASELINE,
        fillColor : Cesium.Color.BLACK,
        showBackground : true,
        backgroundColor : new Cesium.Color(1, 1, 1, 0.7),
        backgroundPadding : new Cesium.Cartesian2(8, 4),
        disableDepthTestDistance : Number.POSITIVE_INFINITY // draws the label in front of terrain
    }
  });


        document.addEventListener(
            "keydown",
            function(e) {
                var flagName = getFlagForKeyCode(e.keyCode);
                if (typeof flagName !== "undefined") {
                    flags[flagName] = true;
                }
                if (flagName == "Search") {
                    voice.voiceCommand();
                }
            },
            false
        );
        document.addEventListener(
            "keyup",
            function(e) {
                var flagName = getFlagForKeyCode(e.keyCode);
                if (typeof flagName !== "undefined") {
                    flags[flagName] = false;
                }
            },
            false
        );
        viewer.clock.onTick.addEventListener(function(clock) {
            var camera = viewer.camera;
            if (flags.looking) {
                var width = canvas.clientWidth;
                var height = canvas.clientHeight;
                // Coordinate (0.0, 0.0) will be where the mouse was clicked.
                var x = xPos / width;
                var y = yPos / height;
                var lookFactor = 0.05;
                camera.lookRight(x * lookFactor);
                camera.lookUp(y * lookFactor);
            }
            // Change movement speed based on the distance of the camera to the surface of the ellipsoid.
            var cameraHeight = ellipsoid.cartesianToCartographic(camera.position).height;
            var moveRate = cameraHeight / 100.0;

            if (flags.moveForward) {
                camera.moveForward(moveRate);
            }
            if (flags.moveBackward) {
                camera.moveBackward(moveRate);
            }
            if (flags.moveUp) {
                camera.moveUp(moveRate);
            }
            if (flags.moveDown) {
                camera.moveDown(moveRate);
            }
            if (flags.moveLeft) {
                camera.moveLeft(moveRate);
            }
            if (flags.moveRight) {
                camera.moveRight(moveRate);
            }

        });

        function toggleGyro() {
            enableGyro = !enableGyro;
        }
    </script>
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <button id='gyroButton' type="button" onClick='toggleGyro()'>
        <div>
            <p>Gyro</p>
            <p id='gyroText'></p>
        </div>
        <!-- <table id="footerTable">
            <tr>
                <td>X: <span id="xOut">0</span></td>
                <td>Y: <span id="yOut">0</span></td>
                <td>Z: <span id="zOut">0</span></td>
            </tr>
        </table> -->
    </button>

</body>

</html>